<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FOCUS WAVE</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a2540">

<style>
:root{
  --bg:#0a2540;
  --fg:#fff;
  --glass:rgba(255,255,255,.15);
  --accent:#00d4ff;
}
*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  background:linear-gradient(180deg,var(--bg),#000);
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  color:var(--fg);
  display:flex;
  justify-content:center;
  align-items:center;
}
.glass{
  backdrop-filter:blur(16px);
  background:var(--glass);
  border-radius:24px;
  padding:16px;
  box-shadow:0 10px 40px rgba(0,0,0,.4);
}
#app{width:360px;text-align:center}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:16px;
  background:var(--accent);
  color:#001;
  font-size:16px;
  margin-top:8px;
}
input{
  width:60px;
  padding:6px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.3);
  background:rgba(255,255,255,.15);
  color:#fff;
  text-align:center;
}
#wave{width:100%;height:180px}
#time{font-size:22px;margin-top:4px}
#score{font-size:34px;font-weight:bold}
.green{color:#3cff8f}
.yellow{color:#ffd93c}
.red{color:#ff6b6b}
.badges{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-top:8px;
}
.badge{
  font-size:12px;
  padding:8px;
  border-radius:12px;
  background:rgba(255,255,255,.2);
}
.locked{opacity:.3}
#analysis{font-size:14px;margin-top:6px}
</style>
</head>

<body>
<div id="app" class="glass">

<h1>ğŸŒŠ FOCUS WAVE</h1>

<div class="glass">
  <input id="h" type="number" min="0" max="12" value="2"> æ™‚é–“
  <input id="m" type="number" min="0" max="59" value="0"> åˆ†
</div>

<svg id="wave" viewBox="0 0 360 200">
  <path id="wavePath" fill="#00d4ff"
   d="M0,200 Q90,180 180,200 T360,200 V200 H0"/>
</svg>

<div id="time">00:00:00</div>
<div id="score" class="green">100</div>

<button onclick="start()">START</button>
<button onclick="pause()">PAUSEï¼ˆ1å›ï¼‰</button>

<h3> AIé›†ä¸­åˆ†æ</h3>
<div id="analysis">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>

<h3>ğŸ† å®Ÿç¸¾</h3>
<div class="badges" id="badges"></div>

</div>

<script>
let TOTAL=0,remain=0,timer=null;
let pauseUsed=false;
let score=100,streak=Number(localStorage.streak||0);
let history=JSON.parse(localStorage.history||"[]");

/* ---- TIMER ---- */
function start(){
  if(timer)return;
  TOTAL=(+h.value*3600)+(+m.value*60);
  if(!TOTAL)return alert("æ™‚é–“ã‚’è¨­å®šã—ã¦ãã ã•ã„");
  remain=TOTAL;score=100;pauseUsed=false;
  document.documentElement.requestFullscreen?.();
  timer=setInterval(()=>{
    remain--;update();
    if(remain<=0)success();
  },1000);
}
function pause(){
  if(pauseUsed)return;
  clearInterval(timer);timer=null;
  pauseUsed=true;
  score=Math.max(score-20,0);
}
function update(){
  time.textContent=format(remain);
  updateWave();
  updateScore();
}
function success(){
  clearInterval(timer);timer=null;
  streak++;localStorage.streak=streak;
  history.push({score,paused:pauseUsed,time:TOTAL});
  localStorage.history=JSON.stringify(history);
  analyze();checkBadges();waveUp();
}

/* ---- UI ---- */
function format(s){
  const h=Math.floor(s/3600),
        m=Math.floor(s%3600/60),
        sec=s%60;
  return [h,m,sec].map(v=>String(v).padStart(2,"0")).join(":");
}
function updateWave(){
  const r=1-remain/TOTAL;
  const y=200-(r*180);
  wavePath.setAttribute("d",
   `M0,${y} Q90,${y-20} 180,${y} T360,${y} V200 H0`);
}
function waveUp(){
  wavePath.setAttribute("d",
   "M0,20 Q90,0 180,20 T360,20 V200 H0");
}
function updateScore(){
  scoreEl.textContent=score;
  scoreEl.className=score>70?"green":score>40?"yellow":"red";
}

/* ---- AIåˆ†æ ---- */
function analyze(){
  const avg=Math.round(
    history.reduce((a,b)=>a+b.score,0)/history.length
  );
  const fail=history.filter(h=>h.paused).length;
  let msg="é›†ä¸­ã¯å®‰å®šã—ã¦ã„ã¾ã™ã€‚";
  if(avg<50)msg="çŸ­æ™‚é–“é›†ä¸­ã‚’å¢—ã‚„ãã†";
  if(fail/history.length>0.3)msg="ä¸­æ–­ãŒå¤šã‚ã€‚ç’°å¢ƒæ”¹å–„ã‚’ã€‚";
  analysis.innerHTML=
   `å¹³å‡ã‚¹ã‚³ã‚¢: ${avg}<br>
    ä¸­æ–­ç‡: ${Math.round(fail/history.length*100)}%<br>
    AIåŠ©è¨€: ${msg}`;
}

/* ---- ãƒãƒƒã‚¸ ---- */
const badgeDefs=[
 {k:"first",t:"åˆæˆåŠŸ"},
 {k:"streak3",t:"3é€£ç¶š"},
 {k:"high",t:"é«˜é›†ä¸­"},
 {k:"long",t:"2hé”æˆ"},
 {k:"many",t:"10å›"}
];
function checkBadges(){
  let u=[];
  if(history.length>=1)u.push("first");
  if(streak>=3)u.push("streak3");
  if(score>=90)u.push("high");
  if(TOTAL>=7200)u.push("long");
  if(history.length>=10)u.push("many");
  renderBadges(u);
}
function renderBadges(list){
  badges.innerHTML="";
  badgeDefs.forEach(b=>{
    const d=document.createElement("div");
    d.className="badge "+(list.includes(b.k)?"":"locked");
    d.textContent=b.t;
    badges.appendChild(d);
  });
}
renderBadges([]);

if("serviceWorker"in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
