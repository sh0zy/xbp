<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Wave App Builder â€“ Prototype</title>
<style>
  body {
    margin: 0;
    background: #05081b;
    color: #fff;
    font-family: system-ui;
  }

  /* ãƒˆãƒƒãƒ—ãƒãƒ¼ */
  .top-bar {
    display: flex;
    justify-content: space-between;
    padding: 12px 20px;
    background: #070b23;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  .mode-switch {
    margin-right: 12px;
  }

  /* ã‚¬ã‚¤ãƒ‰ã‚¨ãƒªã‚¢ */
  .guide-area {
    background: rgba(77, 124, 255, 0.18);
    padding: 12px 16px;
    border-radius: 12px;
    margin: 10px 20px;
    font-size: 15px;
  }

  /* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
  .main-layout {
    display: flex;
    gap: 20px;
    padding: 20px;
  }

  /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
  .input-area {
    flex: 1;
    background: rgba(255,255,255,0.04);
    padding: 20px;
    border-radius: 16px;
  }

  textarea {
    width: 100%;
    height: 220px;
    padding: 12px;
    border-radius: 12px;
    background: rgba(255,255,255,0.12);
    border: none;
    color: #fff;
    resize: none;
  }

  .input-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 13px;
    color: #9aa4ff;
  }

  /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
  .preview-area {
    flex: 1;
    background: rgba(255,255,255,0.04);
    padding: 20px;
    border-radius: 16px;
  }

  .preview-frame {
    width: 360px;
    height: 640px;
    background: #11152f;
    border-radius: 20px;
    padding: 20px;
    overflow-y: auto;
    margin-bottom: 10px;
  }

  .preview-placeholder {
    opacity: 0.6;
    font-size: 14px;
  }

  /* æ¬¡ã«ã‚„ã‚‹ã“ã¨ */
  .next-actions {
    padding: 20px;
  }

  /* ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰ãƒ‘ãƒãƒ« */
  .pro-panels {
    display: none;
    grid-template-columns: 260px 1fr 300px;
    gap: 16px;
    padding: 20px;
  }

  .panel {
    background: rgba(255,255,255,0.05);
    border-radius: 14px;
    padding: 16px;
    backdrop-filter: blur(6px);
    height: 520px;
    overflow-y: auto;
  }

  /* é·ç§»ãƒ•ãƒ­ãƒ¼ */
  .flow-panel {
    display: none;
    background: rgba(255,255,255,0.04);
    margin: 20px;
    padding: 20px;
    border-radius: 16px;
  }

  /* ãƒ˜ãƒ«ãƒ— */
  .help {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    padding: 40px;
    display: none;
  }

  button {
    background: #4d7cff;
    color: #fff;
    border: none;
    border-radius: 999px;
    padding: 8px 16px;
    font-size: 13px;
    cursor: pointer;
  }
</style>
</head>

<body>

<!-- ãƒˆãƒƒãƒ—ãƒãƒ¼ -->
<header class="top-bar">
  <div class="left">
    <span class="logo">Wave App Builder</span>
  </div>

  <div class="right">
    <label class="mode-switch">
      <input type="checkbox" id="minimalModeToggle" checked>
      ãƒŸãƒ‹ãƒãƒ ãƒ¢ãƒ¼ãƒ‰
    </label>

    <button id="guideModeToggle">ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ ON</button>
    <button id="helpBtn">ãƒ˜ãƒ«ãƒ—</button>
  </div>
</header>

<!-- ã‚¬ã‚¤ãƒ‰ã‚¨ãƒªã‚¢ -->
<div id="guideArea" class="guide-area">
   æ¬¡ã¯ã€Œã‚¢ãƒ—ãƒªã®èª¬æ˜ã€ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ã€‚ã‚ãªãŸã®è¨€è‘‰ã§å¤§ä¸ˆå¤«ã ã‚ˆã€‚
</div>

<!-- ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
<div class="main-layout">

  <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
  <section id="inputArea" class="input-area">
    <h3>ğŸ“ ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„</h3>

    <textarea id="appInput"
      placeholder="ä¾‹ï¼šãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã‚’ä½œã‚ŠãŸã„ã€‚ã‚¿ã‚¤ãƒˆãƒ«ã¨å†…å®¹ã‚’ä¿å­˜ã—ãŸã„ã€‚"></textarea>

    <div class="input-actions">
      <span id="autoSaveStatus">è‡ªå‹•ä¿å­˜æ¸ˆã¿</span>
      <button id="undoBtn">Undo</button>
      <button id="redoBtn">Redo</button>
    </div>
  </section>

  <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
  <section id="previewArea" class="preview-area">
    <h3>ğŸ“± ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>

    <div id="previewFrame" class="preview-frame">
      <div class="preview-placeholder">
        ã“ã“ã«ã‚ãªãŸã®ã‚¢ãƒ—ãƒªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <button id="installPWABtn">ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ï¼ˆPWAï¼‰</button>
  </section>

</div>

<!-- æ¬¡ã«ã‚„ã‚‹ã“ã¨ -->
<section id="nextActionsArea" class="next-actions">
  <h3>âœ¨ æ¬¡ã«ã§ãã‚‹ã“ã¨</h3>
  <ul id="nextActions"></ul>
</section>

<!-- ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰ãƒ‘ãƒãƒ« -->
<section id="proModePanels" class="pro-panels">
  <div id="treeView" class="panel">ğŸ“‚ éšå±¤æ§‹é€ </div>
  <div id="canvasPanel" class="panel">ğŸ–¥ï¸ ã‚­ãƒ£ãƒ³ãƒã‚¹</div>
  <div id="propertyPanel" class="panel">âš™ï¸ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</div>
</section>

<!-- é·ç§»ãƒ•ãƒ­ãƒ¼ -->
<section id="screenFlowArea" class="flow-panel">
  <h3>ğŸ”— ç”»é¢é·ç§»ãƒ•ãƒ­ãƒ¼</h3>
  <div id="screenFlowCanvas"></div>
</section>

<!-- ãƒ˜ãƒ«ãƒ— -->
<div id="helpPage" class="help">
  <h2>5åˆ†ã§åˆ†ã‹ã‚‹ Wave App Builder</h2>
  <p>æ–‡ç« ã‚’æ›¸ã â†’ ã‚¢ãƒ—ãƒªãŒã§ãã‚‹ â†’ è§¦ã£ã¦è‚²ã¦ã‚‹</p>
  <button id="closeHelp">é–‰ã˜ã‚‹</button>
</div>

<script>
let appState = {
  structure: null,
  history: [],
  future: [],
  minimalMode: true,
  guideMode: true
};

/* ãƒŸãƒ‹ãƒãƒ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
document.getElementById("minimalModeToggle").addEventListener("change", e => {
  appState.minimalMode = e.target.checked;
  setMinimalMode(appState.minimalMode);
});

function setMinimalMode(isMinimal) {
  document.getElementById("proModePanels").style.display = isMinimal ? "none" : "grid";
  document.getElementById("screenFlowArea").style.display = isMinimal ? "none" : "block";
  renderGuideMessage();
}

/* ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
document.getElementById("guideModeToggle").addEventListener("click", () => {
  appState.guideMode = !appState.guideMode;
  document.getElementById("guideModeToggle").textContent =
    appState.guideMode ? "ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ ON" : "ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ OFF";
  renderGuideMessage();
});

/* ã‚¬ã‚¤ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
function renderGuideMessage() {
  const guide = document.getElementById("guideArea");

  if (!appState.guideMode) {
    guide.textContent = "ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰ï¼šè‡ªç”±ã«ç·¨é›†ã§ãã¾ã™ã€‚";
    return;
  }

  if (!appState.structure) {
    guide.textContent = "ğŸ’¡ æ¬¡ã¯ã€Œã‚¢ãƒ—ãƒªã®èª¬æ˜ã€ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ã€‚ã‚ãªãŸã®è¨€è‘‰ã§å¤§ä¸ˆå¤«ã ã‚ˆã€‚";
  } else {
    guide.textContent = "ğŸ’¡ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è§¦ã£ã¦ã¿ã‚ˆã†ã€‚æ¬¡ã«ç”»é¢ã‚’å¢—ã‚„ã—ãŸããªã£ãŸã‚‰æ•™ãˆã¦ã­ã€‚";
  }
}

/* å…¥åŠ› â†’ è‡ªå‹•ç”Ÿæˆ */
document.getElementById("appInput").addEventListener("input", () => {
  const text = appInput.value.trim();

  if (!text) {
    appState.structure = null;
    renderPreview();
    return;
  }

  // ä»®ã®æ§‹é€ ç”Ÿæˆ
  appState.structure = {
    screens: [
      {
        id: "home",
        name: "ãƒ›ãƒ¼ãƒ ",
        components: [
          { type: "title", text: "ãƒ¡ãƒ¢ä¸€è¦§" },
          { type: "list", items: ["ã‚µãƒ³ãƒ—ãƒ«1", "ã‚µãƒ³ãƒ—ãƒ«2"] },
          { type: "button", text: "æ–°ã—ã„ãƒ¡ãƒ¢" }
        ]
      }
    ]
  };

  renderPreview();
  suggestNextActions();
  renderGuideMessage();
});

/* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æç”» */
function renderPreview() {
  const frame = document.getElementById("previewFrame");

  if (!appState.structure) {
    frame.innerHTML = `<div class="preview-placeholder">ã“ã“ã«ã‚ãªãŸã®ã‚¢ãƒ—ãƒªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>`;
    return;
  }

  const home = appState.structure.screens[0];
  let html = "";

  home.components.forEach(c => {
    if (c.type === "title") html += `<h2>${c.text}</h2>`;
    if (c.type === "list") html += `<ul>${c.items.map(i => `<li>${i}</li>`).join("")}</ul>`;
    if (c.type === "button") html += `<button>${c.text}</button>`;
  });

  frame.innerHTML = html;
}

/* æ¬¡ã«ã‚„ã‚‹ã“ã¨ */
function suggestNextActions() {
  const list = document.getElementById("nextActions");

  if (!appState.structure) {
    list.innerHTML = "<li>ã‚¢ãƒ—ãƒªã®èª¬æ˜ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†</li>";
    return;
  }

  list.innerHTML = `
    <li>ç”»é¢ã‚’ã‚‚ã†1ã¤è¿½åŠ ã—ã¦ã¿ã‚‹</li>
    <li>ãƒœã‚¿ãƒ³ã«æ©Ÿèƒ½ã‚’ã¤ã‘ã‚‹</li>
    <li>ã‚¢ãƒ—ãƒªã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰ãˆã‚‹</li>
  `;
}

/* ãƒ˜ãƒ«ãƒ— */
document.getElementById("helpBtn").addEventListener("click", () => {
  document.getElementById("helpPage").style.display = "block";
});
document.getElementById("closeHelp").addEventListener("click", () => {
  document.getElementById("helpPage").style.display = "none";
});

/* åˆæœŸåŒ– */
window.addEventListener("load", () => {
  setMinimalMode(true);
  renderGuideMessage();
});
</script>

</body>
</html>
